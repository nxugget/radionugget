---
title: "R√©ception automatique d'images satellites NOAA"
date: "2024-05-17"
summary: "D√©couvrez comment recevoir et d√©coder les images des satellites m√©t√©orologiques NOAA en mode APT de mani√®re automatique √† l'aide d'une antenne V-dip√¥le, d'un r√©cepteur SDR et d'un Raspberry"
thumbnail: "/images/blog/thumbnail/noaa.webp"
tags: ["satellite", "space"]
slug: "noaa"
---
Pour tout curieux souhaitant d√©buter dans le milieu de la [<SmartLink slug="sdr">SDR</SmartLink>], recevoir des images satellites en fabriquant sa propre antenne est un excellent point de d√©part pour acqu√©rir des bases en **radiofr√©quence**. On va pousser ce projet un peu plus loin en faisant en sorte que ces images satellites se r√©cup√®rent **automatiquement**.

# Compr√©hension du projet 

## Qui sont les NOAA ?
Les satellites [NOAA](https://fr.wikipedia.org/wiki/NOAA_POES) sont des satellites m√©t√©orologiques am√©ricains situ√©s √† une altitude d'environ `850km`. Pour comparer, l'**ISS** est √† environ `400km`. 
√Ä ce jour, il y en a 3 qui vont nous int√©resser : 

![Satellite NOAA](/images/blog/projects/noaa/noaa.svg)
Leur fr√©quence √©tant publique, n'importe qui avec le mat√©riel ad√©quat peut recevoir leurs images. Ils ne sont plus en p√©riode d'exploitation mais tant que la **NASA** consid√®re qu'ils ne sont pas un danger, ils continuent de les laisser tourner. 
## Orbite h√©liosynchrone 
Ces satellites ont une orbite circulaire qui les font passer d'un p√¥le √† l'autre de la **Terre**. Ce sont des orbites dites **polaire** et plus pr√©cis√©ment **h√©liosynchrone**. Mais pour plus d'infos sur les diff√©rents types d'orbites, tu peux cliquer [<SmartLink href="/blog/space/satellite/orbits">ici</SmartLink>].
Ils se pr√©sentent toute l'ann√©e sous le m√™me angle par rapport au Soleil : 

![Orbite polaire](/images/blog/space/satellite/type-orbits/type-orbits6.svg)
Ainsi, comme la **Terre** tourne sur elle m√™me, le satellite peut balayer toute sa surface. Gr√¢ce √† des [logiciels](https://www.qsl.net/kd2bd/predict.html) ou [sites web](https://www.amsat.org/track/), on peut calculer ses orbites et pr√©voir le passage de chacun par rapport √† des **coordonn√©es g√©ographiques**. Ils passent √† peu pr√®s 2 fois par jour au-dessus d'une m√™me zone.
Par exemple, voici une liste de pr√©dictions au dessus de la ville o√π est install√©e mon antenne: 
![Pr√©dictions satellite](/images/blog/projects/noaa/prediction_pass.svg)
## Transmission APT
Les **NOAA** ne prennent pas directement des photos de la Terre. Ils utilisent un [radiom√®re √† balayage](https://fr.wikipedia.org/wiki/Radiom%C3%A8tre_Avanc%C3%A9_%C3%A0_Tr%C3%A8s_Haute_R%C3%A9solution) qui effectue un **scan** comme le ferait un scanner papier √† une vitesse de 2 lignes par seconde, donc c'est lent. 
Pour cela ils vont utiliser le mode [APT](https://en.wikipedia.org/wiki/Automatic_picture_transmission) (**A**utomatic **P**icture **T**ransmission). Il date de 1960 et seules ces 3 satellites l'utilisent encore. La qualit√© n'est que de `4km` pour 1 pixel. 
Voici un exemple d'image transmise que j'ai re√ßu avec ce syst√®me :

![Image brut APT NOAA](/images/blog/projects/noaa/image_reel.png)
La transmission est compos√©e de **deux canaux d'images**, des **informations t√©l√©m√©triques** et des **donn√©es de synchronisation**. 
- Le premier canal (image de gauche) d'image est pris avec un capteur dans les longueurs d'onde visibles. (Un autre capteur peut √™tre utilis√© en fonction de la quantit√© de nuages). 
- Le second canal (image √† droite) utilise un capteur **infrarouge**. 
- La bande √† **gauche** de chaque image sont des donn√©es de **synchronisation**. Comme les ondes peuvent faire des rebonds dans l'atmosph√®re ou sur d'autres obstacles, elles peuvent ne pas arriver dans le bon ordre jusqu'√† l'antenne, donc ces **bits de donn√©es** sont l√† pour les remettre dans le bon ordre et √™tre s√ªr qu'on re√ßoive le scan correctement. 
- Les **2** bandes √† **droite** de chaque image sont des donn√©es **t√©l√©m√©triques**. Il s'agit d'informations envoy√©s concerant le satellite ainsi que des donn√©es pour la m√©t√©o (c'est √† √ßa qui sert apr√®s tout). 
  
Toutes ces donn√©es vont √™tre envoy√©es ligne par ligne √† l'horizontal. 
Avant d'√™tre diffus√©es, les images recoivent des corrections g√©om√©triques permettant ainsi d'√™tre exempt de la **distorsion** caus√©e par la **courbure** de la Terre ([car oui, la Terre n'est pas plate](https://www.youtube.com/watch?v=l4Po4cdCsI0)).
Ainsi, avec ces deux images captur√©es, on peut obtenir d'autres types d'image. Par exemple, voici une image thermique g√©n√©r√©e par les deux images pr√©c√©dentes : 
![Image thermique NOAA](/images/blog/projects/noaa/image_thermique.png)
C'est gr√¢ce √† ce genre d'image que les personnes dans la m√©t√©orologie seront √† m√™me de pr√©dire le temps qu'il va faire ‚õàÔ∏è.

## Fonctionnement d'une antenne et SDR
Pour r√©cup√©rer leur images, il va nous falloir une **antenne** ainsi qu'un r√©cepteur **SDR**.
Ainsi, je vous recommande de lire les 2 articles que j'ai fais, [<SmartLink href="/blog/radio/basics/antenna">le premier</SmartLink>] pour comprendre comment on choisit une antenne en fonction de la **fr√©quence** qu'on veut √©couter.
[<SmartLink href="/blog/radio/basics/sdr">Le second</SmartLink>] qui explique ce qu'est la **SDR** (**S**oftware **D**efined **R**adio).

# Mise en place du projet
## Partie mat√©rielle
### Fabrication de l'anntenne
Pour ce projet, j'ai d√©cid√© de partir sur une antenne **V-dip√¥le** qui sera plac√©e **horizontalement**. De fait, son **diagramme de rayonnement** sera dirig√© vers le ciel. √áa permet aussi de grandement r√©duire les interf√©rences en provenance des signaux terrestres polaris√©s **veriticalement**.
Malgr√© tout √ßa, ce n'est pas l'antenne optimale pour ce projet (√† cause de sa [polarisation](https://culturesciencesphysique.ens-lyon.fr/ressource/simu-polarisation.xml)) mais √ßa reste la plus simple √† construire donc on va partir l√† dessus pour d√©buter. Si non, on pourrait directement partir sur une antenne [<SmartLink href="/blog/radio/ground/qfh">QFH</SmartLink>].
Les signaux **APT** sont tr√®s r√©sistants donc au final, m√™me avec une antenne non parfaite, on recevra quand m√™me des trucs, le plus important, c'est surtout d'avoir un ciel d√©gag√© avec l'antenne plac√©e le plus haut possible.
Comme vu sur les cours des antennes, pour qu'elle soit **r√©sonnante** √† la fr√©quence de **137MHz**, on peut faire le calcul suivant : `Œª=300/137‚âà2.18m`.
On va faire une antenne **demi-onde** donc elle devra faire une longueur de `2.18/2` soit `1.09m`. 
De plus, comme on fait un **dip√¥le**, on va devoir diviser √† nouveau par **2** pour avoir la longueur de chaque p√¥le. Donc `1.09/2‚âà0.54`. On sait √† pr√©sent que chaque p√¥le devra faire **54cm** pour √™tre efficace au **137MHz**. 
Afin d'avoir une imp√©dance de **50Œ©**, l'angle form√© par les 2 p√¥les doit √™tre de **120¬∞**.

![Schema antenne v-dip√¥le](/images/blog/projects/noaa/vdipole_schema.svg)
Le raccordement entre les p√¥les et le c√¢ble se fait avec un domino. On relie la tige centrale du c√¢ble √† l'un, et la tresse autour du c√¢ble √† l'autre. On peut analyser ses performances avec un testeur d'antenne.

![Dipole cuivre](</images/blog/projects/noaa/dipole cuivre.webp>)
Le deux valeurs √† prendre en compte sont 
- L'imp√©dance -> **R (Œ©)** qui est de **58Œ©** donc pas les **50Œ©** id√©ales mais relativement proche donc c'est cool.
- Le rapport d'onde stationnaire -> **VSWR** qui doit √™tre au plus proche de **1**. Et l√†, **2.8**, c'est pas terrible. 

Les premiers r√©sultats n'√©tant pas tr√®s convaincant, je d√©cide d'enlever le domino et de plut√¥t venir souder les parties entre elles pour que le contact se fassent au mieux. Je r√©cup√®re √† la d√©chetterie une vieille antenne TV pour caravane qui me permet de facilement r√©gler l'orientation des p√¥les pour ajuster l'**imp√©dance** de l'antenne. Et voici le r√©sultat final : 

![Dipole antenna](</images/blog/projects/noaa/dipole antenna.webp>)
- Le **VSWR** est tr√®s proche de **1** ce qui est vraiment pas mal pour le coup. 
- L'**imp√©dance** de **42Œ©** n'est pas parfaite mais reste tout √† fait correct. 

### Placement et Orientation
Une antenne **dip√¥le** n'est pas **omnidirectionelles** et il va falloir la placer correctement. Les **NOAA** avec leur orbite polaire arrive soit par le **nord** soit par le **sud**. Par cons√©quant, on doit orienter l'antenne dans l'une de ses directions, n'importe laquelle. Si on la place vers le **nord** alors que le satellite arrivait par le **sud**, on aura juste √† retourner l'image.  :) 
Voil√† le rendu final de l'antenne sur le toit orient√© plein **sud** dans mon cas : 
![Antenne v-dip√¥le](/images/blog/projects/noaa/roof.JPEG)
√âvidemment, la parabole et l'antenne r√¢teau n'ont rien √† voir pour ce projet. 
### Raspberry
Pour ce projet, j'utilise un **Raspberry 4 model B** qui tourne sur **Raspbian lite OS** en **64-bits**. Il n'aura pas d'**interface graphique** afin d'√©viter toutes fr√©quences parasites provoqu√©es par la consommation du **CPU** et de la **RAM** √† cause des composants graphiques. 
Ce dernier sera plac√© dans les combles dans un tupperware pour le prot√©ger de la poussi√®re. Pour le r√©cepteur **SDR**, j'utilise la cl√© **RTL-SDR V4**. Elle sera reli√©e √† l'antenne par **5m** de c√¢ble coaxial **TV** de r√©cup, mais c'est mieux de prendre un bon c√¢ble style du **RG58**.

![RTL-SDR V4 sur Raspberry](/images/blog/projects/noaa/tupperware.jpg)

### Filtre
Bien que la cl√© **SDR** a pour r√¥le d'enregistrer dans la fr√©quence qu'on lui demande, elle n'est pas parfaite et il y aura toujours des signaux parasites autour. Pour r√©gler ce probl√®me, on peut √™tre tent√© par utiliser un **LNA** (**L**ow **N**oise **A**mplicator). Il va nous permettre de filtrer et amplifier les signaux dans une gamme de fr√©quence bien sp√©cifique. Par exemple, pour ce projet, il faudrait un **LNA 137MHz** comme [celui-ci](https://www.amazon.fr/NooElec-SAWbird-NOAA-Applications-Fr%C3%A9quence/dp/B07TWPR871/ref=sr_1_1?__mk_fr_FR=%C3%85M%C3%85%C5%BD%C3%95%C3%91&crid=3JXDFIBNMHG1C&dib=eyJ2IjoiMSJ9.mFFmWr9UNDTELd7jA4G3G_iBBoiZyBRdYts8EgwXjuPBWJLnSzPtd_hfNc6sTTgiroKvpfoo1WDs9PUSsw-bGdF9iZwPsRWrWcLuK9lIbKwP4fd7HcMHoxqDOJy0zJAWGNPMXH_JHCNHBzbCmf7j052pjModyeE24G2PRjrts9uRofPh-Hig5qU23rs-xIFGjjdblbDF-z591mkmuFgJmsfqtFTj0ovWvRypJBq-TU33UGYfUyFhZocThOVzagjOwaeGVeWTvkWXhrZhwu7GRGdtG05_gowpSti7dIi5EWQ.UU5r_ajUrMU4Jy6f6F7zP7GwyrtH0BbD78t7OoBGTf8&dib_tag=se&keywords=nooelec+137&qid=1726996924&sprefix=nooelec+13%2Caps%2C97&sr=8-1). 
Il est important de le placer au plus pr√™t de l'antenne, afin d'amplifier le signal d√®s que possible. Ainsi, on est sur que le signal ne se perde pas durant le trajet. 

‚ö†Ô∏è Mais attention, l'efficacit√© d'un filtre d√©pendra de pleins de facteurs compelxes. Car m√™me si le signal du NOAA sera amplifi√©, le **bruit parasite** le sera aussi. Et dans mon cas, pour l'avoir test√©, √ßa ne change vraiment rien d'avoir un filtre donc je ne recommande pas d'investir dedans.

## Partie logicielle
Afin de tester toute notre cha√Æne mat√©rielle, on peut d'abord brancher notre r√©cepteur **SDR** √† un ordinateur avec un logiciel comme [SatDump](https://www.satdump.org/download/) et tenter de r√©cup√©rer un signal manuellement. 
Si tout fonctionne, en th√©orie on pourrait s'arr√™ter l√† pour le projet, mais pour aller plus loin, on va faire en sorte d'automatiser tout √ßa pour avoir un site qui contiendra toutes nos images r√©cup√©r√©es üñºÔ∏è.
### Github
Pour ce projet, j'ai d√©cid√© d'utiliser ce [d√©p√¥t Git](https://github.com/jekhokie/raspberry-noaa-v2) qui va grandement nous √™tre utile. 
Pour l'installer, on le `git clone` sur le **Raspberry**, puis on √©dite le fichier `config/settings.yml` pour y mettre nos coordonn√©es **g√©ographiques** ainsi que d'autres param√®tres selon nos besoins. 
Voici quelques exemples de param√®tres que j'ai chang√© : 
```bash
# Les coordonn√©es de o√π est install√©e votre antenne.
latitude: 37.2387771634851
longitude: -115.80047482064876
altitude: 1360

# Le logiciel satdump est plus r√©cent et plus efficace. 
noaa_decoder: 'satdump'
meteor_decoder: 'satdump'

# Le signal au d√©but et la fin du passage est tr√®s faible ce qui cr√©e pas mal de bruit sur notre image. On peut alors rogner ces parties pour avoir une meilleure image. 
noaa_crop_toptobottom: true

# Perso, j'aime bien avoir une image naturelle sans les fronti√®res et grilles.
noaa_map_crosshair_enable: false
...
noaa_map_grid_degrees: 0.0
...
noaa_map_country_border_enable: false
...
noaa_map_state_border_enable: false
```

On a plus qu'√† lancer l'installation en ex√©cutant le script `./install_and_upgrade.sh` (√ßa prend du temps) et nous voil√† avec un site web affichant tous les passages pr√©vus des satellites, un enregistrement qui se lance automatiquement et une page **Capture** avec l'ensemble des images r√©cup√©r√©es. Super pratique ! 
### Acc√®s √† distance 
Apr√®s l'installation, un serveur web **nginx** est cr√©√© en `localhost` sur le **Raspberry** accessible donc que depuis le r√©seau local. 
Si vous avez un **nom de domaine** et que vous souhaitez acc√©der √† votre site depuis n'importe o√π, vous pouvez associer votre site √† l'adresse IP de votre box internet. Gr√¢ce au tool **GitHub**, on a la possibilit√© de g√©n√©rer des certificats **HTTPS** tr√®s facilement pour am√©liorer la s√©curit√© du site. Vous pouvez consulter [ce guide](https://github.com/jekhokie/raspberry-noaa-v2/blob/master/docs/tls_webserver.md) pour en savoir plus. Dans mon cas, ma station est accessible depuis [ici](https://station.radionugget.com).

### Pr√©diction
Pour pr√©dire le passage des satellites, on a un **cronjob** qui va se lancer chaque jour √† **00h00**. Il va s'occuper d'aller chercher les [<SmartLink href="/blog/space/satellite/tle">TLE</SmartLink>] (**T**wo **L**ines **E**lements) des satellites en ligne. Il s'agit d'une repr√©sentation standardis√©e des **param√®tres orbitaux** des objets en **orbite terrestre**. C'est gr√¢ce √† ces param√®tres que l'on va pouvoir pr√©dire √† quelle heure un satellite va passer au dessus d'un point donn√©. 
Une fois r√©cup√©r√©e, on a une base de donn√©es √† jour contenant la position des satellites qui nous int√©ressent. 
Ainsi, on peut faire appel √† l'outil `predict` qui va pr√©dire le passage des satellites en sa basant sur les **TLE**, et sur la **position g√©ographique** du fichier `setting.yml`. Ce dernier va nous donner un intervalle durant laquelle le satellite va passer en nous indiquant l'√©l√©vation maximale du passage. 
Un exemple de la commande lanc√©e manuellement : 
```bash
> nugget@noaa:~ $ predict -p "NOAA 15" -t /home/nugget/.config/satdump/satdump_tles.txt
1714330922 Sun 28Apr24 19:02:02    0  173  192   17  358   3297  35014 * 0.000000
1714331020 Sun 28Apr24 19:03:40    7  175  196   23  359   2648  35014 * 0.000000
1714331117 Sun 28Apr24 19:05:17   15  178  200   29    0   2017  35014 * 0.000000
1714331212 Sun 28Apr24 19:06:52   29  185  204   35    2   1446  35014 * 0.000000
1714331299 Sun 28Apr24 19:08:19   49  202  208   40    4   1030  35014 * 0.000000
1714331365 Sun 28Apr24 19:09:25   64  248  211   43    5    886  35014 * 0.000000
1714331410 Sun 28Apr24 19:10:10   59  293  213   46    6    919  35014 * 0.000000
1714331461 Sun 28Apr24 19:11:01   45  318  215   49    7   1079  35014 * 0.000000
1714331532 Sun 28Apr24 19:12:12   29  331  218   53    9   1423  35014 * 0.000000
1714331618 Sun 28Apr24 19:13:38   17  337  222   58   12   1937  35014 * 0.000000
1714331713 Sun 28Apr24 19:15:13    8  341  226   63   16   2543  35014 * 0.000000
1714331810 Sun 28Apr24 19:16:50    1  343  230   69   21   3185  35014 * 0.000000
1714331830 Sun 28Apr24 19:17:10    0  344  230   70   23   3314  35014 * 0.000000
```
Ici, on demande les pr√©dictions du satellite **NOAA 15** en pr√©cisant un fichier **TLE** √† jour. L'√©l√©vation est indiqu√© par la **5√®me** colonne.
On voit que le prochain passage aura lieu entre **19:02** (premi√®re ligne) et **19:17** (derni√®re ligne) et que l'√©l√©vation maximale aura lieu √† **19:09** (6√®me ligne) et sera de **64¬∞**. 

### Traitement du signal
Mais au final, qu'est ce qu'on enregistre, des images ? Et bien non. En r√©alit√©, l'enregistrement consiste en la r√©cup√©ration d'un fichier audio ! 
La commande principale ressemble √† √ßa : 
```bash
./satdump live noaa_apt --source $receiver --samplerate $samplerate $ppm_correction --frequency "${NOAA_FREQUENCY}e6" --sdrpp_noise_reduction $gain_option $GAIN  $crop_topbottom --start_timestamp $PASS_START --save_wav $finish_processing --timeout $CAPTURE_TIME 
```
On va pas rentrer dans les d√©tails de chacun des arguments mais cette commande permet d'enregistrer le signal et de le traiter en m√™me temps afin de convertir le **signal audio** en une **image**. Vous trouverez des infos sur les arguments [ici](https://docs.satdump.org/pipelines.html) et [ici](https://docs.satdump.org/sdr_options.html).

### R√©cup√©ration des images
Une fois tout le traitement termin√©, [satdump](https://www.satdump.org/download/) va appliquer un traitement sur l'image re√ßue selon ce que l'on a mis comme param√®tres dans le fichier `settings.yml`. Ainsi, il va pouvoir en g√©n√©rer plusieurs, comme des images en couleurs ou en vision thermique. Ces derni√®res √©tant disponible depuis la section `captures` de votre site.
Voici un exemple de la m√™me image de **NOAA 19** re√ßue mais avec un traitement diff√©rent :
![NOAA images](/images/blog/projects/noaa/image_noaa.jpg)  
Comme vous pouvez le voir, il y a pas mal de bandes en plein milieu, ce sont des interf√©rences dues √† mon antenne qui n'est pas parfaite. J'y travaille afin d'avoir une image parfaitement nette.
Les images que je r√©cup√®re sont disponibles sur ma station [juste ici](https://station.radionugget.com/captures).

# Suite et Am√©liorations
## METEOR
Si vous avez tout correctement configur√©, vous avez d√ª voir qu'il y a 2 autres satellites appel√©s **METEOR** qui sont r√©cup√©r√©s. Ce sont aussi des satellites m√©t√©os qui √©mettent sur les `137MHz`. C'est pour cela qu'avec le m√™me mat√©riel que pour les **NOAA**, vous pouvez les recevoir. Plus d'infos sur ces satellites russes [<SmartLink href="/blog/space/satellite/meteor">ici</SmartLink>]).

## HRPT
En r√©alit√©, ces satellites peuvent envoyer de plus belles images que √ßa. On l'a dit, mais le protocole **APT** date de **1960** alors que ces satellites ont √©t√© envoy√©s dans les ann√©es **2000**. En fait, c'est juste pour une question de r√©tro-compatibilit√© avec de vieux √©quipements. Mais sinon, les m√©t√©orologues vont utiliser un protocole plus r√©cent, le [HRPT](https://en.wikipedia.org/wiki/High-resolution_picture_transmission) (¬†**H**igh-**R**esolution **P**icture **T**ransmissions). Les **NOAA** envoient avec ce mode sur des fr√©quences plus hautes, **1700MHz**. Leur r√©ception demande plus de connaissance et surtout une antenne tout autre. Il s'agit de la suite logique de ce projet afin d'avoir des images toujours plus belles car l√† o√π l'**APT** nous donnait du **4km/pixel**, l'**HRPT** nous donne du **1km/pixel**. C'est comme pass√© d'un √©cran **FULL HD** √† de la **4K** :)  

